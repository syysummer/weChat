<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="icon" href="./static/favicon.ico">

  <!-- 启动画面 -->
  <!--iPhone-->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 320px)" rel="apple-touch-startup-image" />
  <!-- iPhone Retina -->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <!-- iPhone 5 -->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
  <!-- iPad portrait -->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 768px) and (orientation: portrait)" rel="apple-touch-startup-image" />
  <!-- iPad landscape -->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 768px) and (orientation: landscape)" rel="apple-touch-startup-image" />
  <!-- iPad Retina portrait -->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 1536px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <!-- iPad Retina landscape -->
  <link href="./src/assets/images/loding_img.gif" media="(device-width: 1536px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <meta name="screen-orientation" content="portrait" />
  <meta name="format-detection" content="email=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="full-screen" content="yes" />
  <meta name="x5-fullscreen" content="true" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="HandheldFriendly" content="true">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="x5-orientation" content="portrait" />
  <meta name="browsermode" content="application" />
  <meta name="x5-page-mode" content="app" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- 清除浏览器缓存 -->
  <!-- <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" /> -->

  <title></title>
</head>

<body>
  <div id="app"></div>
  <!-- <script id="map_script" type="text/javascript"></script> -->
  <script id="map_script" type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvAsx_SoeYJ5kIUBDaMpyj92B8bvGt4Zw&libraries=places&language=en-us"></script>
  <script>
    window.onbeforeunload = function () {
      localStorage.setItem("current_address_latlng", "");
      sessionStorage.setItem("current_city_name", "");
      sessionStorage.setItem('current_city_address', "");
    };
    var cnzz_s_tag = document.createElement('script')
    cnzz_s_tag.type = 'text/javascript'
    cnzz_s_tag.async = true
    cnzz_s_tag.charset = 'utf-8'
    cnzz_s_tag.src = 'https://s13.cnzz.com/z_stat.php?id=1275023386&web_id=1275023386'
    var spt = document.getElementsByTagName('script')[0]
    spt.parentNode.insertBefore(cnzz_s_tag, spt)
    var _czc = _czc || []

    // 根据语言改变标题和地图语言
    var lang = getCookie('lang');
    var script_box = document.getElementById('map_script');
    // 设置HTML文档语言
    var html_lang = document.querySelector('html');

    var arr = script_box.src.split("language=");
    if (lang == 'zh') {
      // arr.splice(1, 1, "zh-cn");
      arr.splice(1, 1, "en-us");
      script_box.setAttribute("src",
        "https://maps.googleapis.com/maps/api/js?key=AIzaSyBvAsx_SoeYJ5kIUBDaMpyj92B8bvGt4Zw&libraries=places&language=" +
        arr[1]);

      document.querySelector("title").innerHTML = "龙外卖";
      // 设置HTML文档语言
      html_lang.setAttribute("lang", 'zh');
    } else if (lang == 'en') {
      arr.splice(1, 1, "en-us");
      script_box.setAttribute("src",
        "https://maps.googleapis.com/maps/api/js?key=AIzaSyBvAsx_SoeYJ5kIUBDaMpyj92B8bvGt4Zw&libraries=places&language=" +
        arr[1]);

      document.querySelector("title").innerHTML = "Loong Delivery";
      // 设置HTML文档语言
      html_lang.setAttribute("lang", 'en');
    }

    // 设置rem
    document.querySelector('html').style.fontSize =
      document.querySelector('html').clientWidth / 12 + 'px';
    window.onresize = function () {
      document.querySelector('html').style.fontSize =
        document.querySelector('html').clientWidth / 12 + 'px'
    }

    // 获取cookie
    function getCookie(name) {
      var arr1 = document.cookie.split("; ");
      for (var i = 0; i < arr1.length; i++) {
        var arr2 = arr1[i].split("=");
        if (arr2[0] == name) {
          return arr2[1];
        }
      }
      return "";
    }

    // 埋点
    let body = document.getElementsByTagName('body')[0]
    body.addEventListener('click', function (e) {
      let target = e.target
      if (target.className.indexOf('btn_login') !== -1) _czc.push(['_trackEvent', 'login', '登录账号'])
      if (target.className.indexOf('logout') !== -1) _czc.push(['_trackEvent', 'logout', '退出账号'])
      if (target.className.indexOf('select_zh') !== -1) _czc.push(['_trackEvent', 'language_selection_Chinese',
        '选择中文'
      ])
      if (target.className.indexOf('select_en') !== -1) _czc.push(['_trackEvent', 'language_selection_Chinese',
        '选择英文'
      ])
      if (target.className.indexOf('home_search') !== -1) _czc.push(['_trackEvent', 'search', '使用搜索'])
      if (target.className.indexOf('home_coupon_box') !== -1) _czc.push(['_trackEvent', 'click_To_receive',
        '点击抢优惠券'
      ])
      if (target.className.indexOf('get_coupon') !== -1) _czc.push(['_trackEvent', 'get_coupon', '领取优惠券'])
      if (target.className.indexOf('use_coupon') !== -1) _czc.push(['_trackEvent', 'use_coupon', '使用优惠券'])
      if (target.className.indexOf('click_classical') !== -1) {
        _czc.push(['_trackEvent', '点击' + target.getAttribute('classical'), '点击' + target.getAttribute('classical')])
      }
      if (target.className.indexOf('sort_list') !== -1) _czc.push(['_trackEvent', '点击' + target.innerHTML, '点击' +
        target.innerHTML
      ])
      if (target.className.indexOf('filter_list') !== -1) _czc.push(['_trackEvent', '点击' + target.innerHTML, '点击' +
        target.innerHTML
      ])
      if (target.className.indexOf('jump_user') !== -1) _czc.push(['_trackEvent', 'click_my', '点击"我的"'])
      if (target.className.indexOf('click_feedback') !== -1) _czc.push(['_trackEvent', 'click_feedback', '点击意见反馈'])
      if (target.className.indexOf('click_merchant') !== -1) _czc.push(['_trackEvent', 'click_recruitment',
        '点击商家入驻'
      ])
    })

    // 隐藏浏览器工具栏
    function hideAddressBar_ios() {
      if (document.documentElement.scrollHeight <= document.documentElement.clientHeight) {
        bodyTag = document.getElementsByTagName('body')[0];
        bodyTag.style.height = document.documentElement.clientWidth / screen.width * screen.height + 'px';
      }
      setTimeout(function () {
        window.scrollTo(0, 1);
      }, 100);
    };

    function hideAddressBar_android() {
      var n = navigator.userAgent;
      if (n.match(/UCBrowser/i)) {
        hideAddressBar_ios();
        return false;
      }
      var self = document.getElementsByTagName('body')[0];
      if (self.requestFullscreen) {
        self.requestFullscreen();
      } else if (self.mozRequestFullScreen) {
        self.mozRequestFullScreen();
      } else if (self.webkitRequestFullScreen) {
        self.webkitRequestFullScreen();
      }
    };
    // navigator.userAgent.match(/Android/i) ? hideAddressBar_android() : hideAddressBar_ios();

    if (!getQueryString('code') && !sessionStorage.getItem('wechatCode')) {
      let url = window.location.href
      localStorage.setItem("urls",url)
      localStorage.setItem("language",getQueryString('language'))
      localStorage.setItem("orderId",getQueryString('orderId'))
      localStorage.setItem("activityId",getQueryString('activityId'))
      if (url.indexOf('envelope_register') != -1) {
        location.href = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx8c1963d098f424c2&redirect_uri=https://dev.hzxindakeji.com/wechat/envelope_register&response_type=code&scope=snsapi_userinfo#wechat_redirect`;
      } else if (url.indexOf('feedback') != -1) {
        location.href = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx8c1963d098f424c2&redirect_uri=https://dev.hzxindakeji.com/wechat/feedback&response_type=code&scope=snsapi_userinfo#wechat_redirect`;
      } else if (url.indexOf('order') != -1) {
        location.href = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx8c1963d098f424c2&redirect_uri=https://dev.hzxindakeji.com/wechat/order&response_type=code&scope=snsapi_userinfo#wechat_redirect`;
      } else {
        location.href = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx8c1963d098f424c2&redirect_uri=https://dev.hzxindakeji.com/wechat/&response_type=code&scope=snsapi_userinfo#wechat_redirect`;
      }
    } else {
      let code = getQueryString('code')
      // localStorage.setItem("language",getQueryString('language'))
      // localStorage.setItem("orderId",getQueryString('orderId'))
      // localStorage.setItem("activityId",getQueryString('activityId'))
      sessionStorage.setItem('wechatCode', code)
    }

    function getQueryString(name) {
      var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
      var r = window.location.search.substr(1).match(reg);
      if (r != null) {
        return unescape(r[2]);
      }
      return null;
    }
  </script>
</body>

</html>
